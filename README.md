# Onfine

![](/preview.png)

[Docker образ](https://hub.docker.com/r/jackzabeivorota/onfine) (Внутрішній порт образу - 8000)

# Опис
Чат із end-to-end шифруванням, в якому можливо створювати парні чати, та приватні (зашифровані) або публічні групи і канали. Головною особливістю проекту є його робота в браузері, так як крипто-дані не повинен знати сервер за для конфеденційності користувачів, а користувачі при цьому повинні знати мінімум інформацї. Це досягається за рахунок хешування паролю введеного юзером та розбиття його на дві частини: перша виступає паролем для авторизації на сайті, а друга являється криптоключем.
Таким чином, користувачеві потрібно запап'ятати лише свій пароль для безпечного спілкування через будь-який браузер. Але якщо юзер забуде свій пароль, то відновити доступ до чатів буде неможливо, про що свідчить банер при реєстрації.

# Технології і залежності

### Back-end:
- Python 3.11.7
- FastAPI 0.110.3
- SQLAlchemy 2.0.29
- Alembic 1.13.1
- BCrypt 4.1.2

### Front-end:
- Node 20.12.0
- React 18.2.0
- React-dom 18.2.0
- Redux 8.1.3
- Reduxjs/toolkit 1.9.7
- Crypto-js 4.2.0
- JSEncrypt 3.3.2

---


# Структура проекту

### Back-end:

- **main.py** - головний файл, з якого здійснюється запуск додатку. В ньому створюєтья змінна `app`, вказуютья middleware, шляхи до статичних файлів, ендпоінт головної сторінки та веб сокету;
- **tools.py** - зберігає універсальні допоміжні інструменти (функції, класи, глобальні змінні), які використовуються по всьому проекту;

#### database/
- **database.py** - файл з налаштуваннями бази даних;
- **models.py** - зберігає моделі бази даних;

#### models/
- **requests.py** - pydantic моделі запитів до сервера;
- **responses.py** - pydantic моделі відповідей від сервера;

#### routes/
- **chat.py, message.py, user.py** - файли з єндпоінтами, які пов'язані з чатами, повідомленнями та юзерами;


### Front-end:

- **index.js** - головний файл проекту, з якого здійснюється вхід в додаток;
- **index.css** - містить базові глобальні стилі;
- **tools.js** - зберігає універсальні допоміжні інструменти (функції, класи, глобальні змінні), які використовуються по всьому проекту;
- **websocket.js** - файл, який містить функцію підключення до сервера по веб сокету та прийом від нього повідомлень;

#### fonts/
- Містить файли зі шрифтами.

#### images/
- Містить зображення та іконки для проекту.

#### styles/
- Містить файли із глобальними стилями (класи для певних конструкцій з тегів).

#### store/
- **icons.js** - файл з імпортованним іконками;
- **localData.js** - містить глобальні дані та змінні проекта і користувача;
- **store.js** - містить конфігурацію сховища;
- **globalSlice.js** - глобальний редюсер, який включає в себе такі дії як реєстрацію користувача, авторизація, зміна особистих даних і так далі, а також стани відображення вікон, іконки, теми додатку та інше;
- **chatSlice.js** - редюсер для дій з чатом, який також вміщає в себе дані пов'язані з чатами, повідомленнями та дані юзерів.

#### view/
- **App.jsx** - головний компонент додатку, який відображає всі інші компоненти, та оперує відображенням інших вікон;
- **auth/Auth.jsx** - відображає вікно авторизації/реєстрації;
- **chats/Chats.jsx** - відображає вікно зі списком чатів `ChatItem.jsx`, в якому також міститься вікно із повідомленнями вибраного чату `Chat.jsx` або вікно із постами каналів, на який підписаний користувач `Posts.jsx`;
- **chats/ChatItem.jsx** - елемент списку чатів;
- **chats/ChatSelector.jsx** - вікно для вибору чатів;
- **chat/Chat.jsx** - вікно для відображення, відправки та видалення повідомлень `Message.jsx`, а також відображення основної інформації чату;
- **chat/Message.jsx** - компонент, який містить дані повідомлення;
- **posts/Posts.jsx** - вікно із набором постів `Post.jsx`;
- **posts/Post.jsx** - компонента, який містить дані посту (повідомлення з каналу);
- **menu/Menu.jsx** - компонент, який відображає бокове меню з діями та основну інформацію користувача;
- **alert/Alert.jsx** - відображає оповіщення користувачеві;
- **alert/DialogAlert.jsx** - відображає діалогове вікно;
- **chatMaster/ChatMaster.jsx** - модальне вікно для створення чату, або зміни його данних;
- **chatInfo/ChatInfo.jsx** - модальне вікно для відображення докладної інформації про чат;
- **userInfo/UserInfo.jsx** - модальне вікно для відображення докладної інформації про користувача;
- **userDataUpdater/UserDataUpdater.jsx** - модальне вікно для зміни інформації і паролю користувача, та видалення його аккаунту;
- **userSelector/UserSelector.jsx** - модальне вікно для вибору юзерів;
- **userSelector/UserItem.jsx** - єлемент списку юзерів;

---


# API

#### Main
- **/, view (GET)** - повертає React додаток;
- **ws** - підключення клієнтів по веб сокету. Після підключення, клієнт повинен відправити дані авторизації, після чого всім користувачам прийде оповіщення, що данний юзер в мережі і сам юзер зможе отримувати оповіщення. А після відключення, користувачам відправиться оповіщення, що юзер більше не в мережі, і користувач автоматично виходе з системи;
- **images (GET)** - поверає зображення збережені користувачами на сервері;

#### user/
- **register (POST)** - реєстрація користувача;
- **login (POST)** - авторизація користувача;
- **logout (POST)** - вихід користувача з системи;
- **pub_keys (POST)** - повертає публічні ключі вказаних в запиті користувачів;
- **update_keys_data (PUT)** - зміна публічного та приватного ключів користувача, та встановлення перешифрованих новим публічним ключом ключів шифрування приватних чатів;
- **users (POST)** - повертає дані всіх вказанних в запиті користувачів;
- **update_data (PUT)** - зміна даних та аватарки користувача;
- **update_password (PUT)** - зміна паролю та приватного ключа користувача;
- **delete_user (DELETE)** - видалення користувача з системи;
- **search (POST)** - повертає дані юзерів (окрім того юзера, який робить запит), нікнейми яких містять вказаний в запиті підрядок. Опціонально можна вказати идентифікатор чату, щоб не повертати користувачі, які до нього входять.

#### message/
- **send (POST)** - відпралення повідомлення в чати;
- **like (POST)** - лайкнути/дизлайкнути повідомлення;
- **delete (DELETE)** - видалення повідомлень.

#### chat/
- **posts (POST)** - повертає відсортований по датам публікацій список постів від каналів, на які підписаний користувач, які вишли після вказанної в запиті дати та часу;
- **messages (POST)** - повертає відсортований по датам відправки список повідомлень із вказанного в запиті чату, які вишли після вказанної в запиті дати та часу;
- **all_chats (POST)** - повертає список чатів користувача;
- **create (POST)** - створює чат, групу або канал, та додає до нього вказанних в запиті користувачів;
- **update (PUT)** - змінює інформацію групи або каналу;
- **read (POST)** - відмічає та сповіщає користувачів чату, який вказаний в запиті, що його повідомлення були прочитані;
- **chat_users (POST)** - повертає ідентифікатори користувачів, які є в указанному в запиті чаті;
- **add_members (POST)** - додає указаніх в запиті користувачів до вказанного чату;
- **remove_members (DELETE)** - видаляє з чату вказанних в запиті користувачів;
- **join (POST)** - додає користувача до вказаної в запиті публічної групи або каналу;
- **leave (POST)** - видаляє користувача з вказаної в запиті групи або каналу;
- **delete (DELETE)** - видаляє вказаний в запиті чат;
- **writing (POST)** - сповіщає юзерів вказанного в запиті чату про статус друкування користувача (друкує або ні);
- **search (GET)** - повертає чати, назва яких містить вказанний в параметрах підрядок, та опціонально відфільтровані по вказанному типу чата;